<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="layout/head :: head"></head>

<style>
/* 상품 카드 */
.product-card {
    border: none;
    border-radius: 15px;
    transition: all 0.2s ease;
    position: relative;
}

.product-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 20px rgba(0,0,0,0.1);
}

/* 품절 상태 */
.out-of-stock {
    opacity: 0.6;
}

/* 품절 배지 */
.out-of-stock::after {
    content: "품절";
    position: absolute;
    top: 12px;
    right: 12px;
    background: #dc3545;
    color: #fff;
    padding: 6px 12px;
    font-size: 0.8rem;
    font-weight: bold;
    border-radius: 20px;
}

/* disabled 버튼 UX 개선 */
button:disabled {
    cursor: not-allowed;
    opacity: 0.7;
}
</style>

<body class="d-flex flex-column min-vh-100 bg-light">

<!-- 헤더 -->
<div th:replace="layout/header :: header"></div>

<div class="container mt-5 mb-5">

    <h3 class="mb-4 fw-bold">상품 목록</h3>

    <div class="row">

        <!-- 상품 반복 -->
        <div class="col-md-4 mb-4"
             th:each="p : ${products}">

            <div class="card product-card shadow-sm p-3"
                 th:classappend="${p.stock == 0} ? ' out-of-stock'">

                <!-- 상품 이미지 -->
                <a th:href="@{/product/{id}(id=${p.id})}">
				    <img th:src="${p.imageUrl}"
				         class="card-img-top rounded"
				         style="height: 200px; object-fit: cover; cursor:pointer;">
				</a>

                <div class="card-body text-center">

                    <!-- 상품명 -->
                    <h5 class="card-title fw-bold"
                        th:text="${p.name}">
                    </h5>

                    <!-- 가격 -->
                    <p class="text-primary fw-semibold mb-1"
                       th:text="${T(java.lang.String).format('%,d원', p.price)}">
                    </p>

                    <!-- 재고 표시 -->
                    <p class="small text-muted mb-2"
                       th:text="'재고 : ' + ${p.stock}">
                    </p>

                    <!-- 구매 버튼 -->
                    <button class="btn btn-primary w-100 mb-2"
                            th:disabled="${p.stock == 0}"
                            th:text="${p.stock == 0} ? '품절' : '구매하기'">
                    </button>

                    <!-- 관리자 전용 버튼 -->
                    <div th:if="${loginUser != null and 
                                 (loginUser.role == 'MANAGER' or loginUser.role == 'PRODUCTER')}">

                        <a th:href="@{/product/form(id=${p.id})}"
                           class="btn btn-sm btn-info me-2">
                            수정
                        </a>

                        <button class="btn btn-sm btn-danger"
                                th:onclick="'deleteProduct(' + ${p.id} + ')'">
                            삭제
                        </button>

                    </div>

                </div>
            </div>

        </div>

    </div>
</div>

<!-- 삭제 스크립트 -->
<script>
function deleteProduct(id) {
    if (!confirm("정말 삭제하시겠습니까?")) return;

    fetch("/product/delete?id=" + id, {
        method: "POST"
    })
    .then(() => {
        alert("삭제되었습니다.");
        location.reload();
    })
    .catch(() => {
        alert("삭제 실패");
    });
}
</script>

<!-- 푸터 -->
<div th:replace="layout/footer :: footer"></div>

</body>
</html>