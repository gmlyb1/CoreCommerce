<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head th:replace="layout/head :: head">
    <meta charset="utf-8">
    <title>CoreCommerce</title>
</head>

<body>

<div th:replace="layout/header :: header"></div>

<!-- ========================= BANNER ========================= -->

<div class="container-fluid carousel bg-light px-0">
    <div class="row g-0 justify-content-end">
        <div class="col-12 col-lg-7 col-xl-9">

            <div class="header-carousel owl-carousel bg-light py-5">

                <div class="row g-0 header-carousel-item align-items-center"
                     th:each="banner : ${bannerList}"
                     th:if="${banner.useYn == 'Y'}">

                    <div class="col-xl-6">
                        <img th:if="${banner.imageUrl != null}"
                             th:src="@{${banner.imageUrl}}"
                             class="img-fluid rounded-4">
                    </div>

                    <div class="col-xl-6 p-4">
                        <h4 th:text="${banner.subtitle}"></h4>
                        <h1 th:text="${banner.title}"></h1>
                        <p th:text="${banner.description}"></p>

                        <a th:if="${banner.linkUrl != null}"
                           th:href="${banner.linkUrl}"
                           class="btn btn-primary rounded-pill">
                            Shop Now
                        </a>

                    </div>

                </div>

            </div>

        </div>
    </div>
</div>

<!-- üî• Íµ¨Î∂ÑÎùºÏù∏ -->
<div class="section-divider"></div>

<!-- ========================================================= -->
<!-- ======================= OFFER =========================== -->
<!-- ========================================================= -->

<div class="container py-5">

    <div class="text-center mb-5">
        <h2 class="fw-bold">Í¥ëÍ≥† ÏÉÅÌíà</h2>
        <div class="title-line mx-auto"></div>
    </div>

    <div class="row g-4">

        <div class="col-lg-6"
             th:each="offer : ${offerProductList}">

            <a th:href="@{/product/{id}(id=${offer.id})}"
               class="d-flex justify-content-between align-items-center border rounded p-4 bg-white shadow-sm">

                <div>
                    <p class="text-muted" th:text="${offer.description}"></p>
                    <h3 class="fw-bold" th:text="${offer.name}"></h3>
                    <h1 class="text-danger">
                        <span th:text="${offer.discountPercent + '%'}"></span>
                        Off
                    </h1>
                </div>

                <img th:src="${offer.imageUrl}"
                     style="max-height:150px; object-fit:contain;">

            </a>

        </div>

    </div>

</div>

<!-- üî• Íµ¨Î∂ÑÎùºÏù∏ -->
<div class="section-divider"></div>

<!-- ========================================================= -->
<!-- ===================== MAIN PRODUCT ====================== -->
<!-- ========================================================= -->

<div class="container py-5">

    <div class="text-center mb-5">
        <h2 class="fw-bold">All Products</h2>
        <div class="title-line mx-auto"></div>
    </div>

    <div class="row g-4">

        <div class="col-md-6 col-lg-4 col-xl-3"
             th:each="product : ${MainPageList}">

            <div class="card product-card border-0 shadow-sm h-100">

                <div class="position-relative overflow-hidden product-img-wrap">

                    <img th:src="${product.imageUrl}"
                         class="card-img-top product-img">

                    <div class="product-hover">

                        <a th:href="@{/product/{id}(id=${product.id})}"
                           class="btn btn-light rounded-circle">
                            <i class="fas fa-eye"></i>
                        </a>

                        <button type="button"
                                class="btn btn-light rounded-circle"
                                th:onclick="'toggleWishlist(' + ${product.id} + ', this)'">

                            <i th:class="${product.liked} ? 
                               'fas fa-heart text-danger' :
                               'far fa-heart text-muted'">
                            </i>

                        </button>

                    </div>

                    <span class="badge bg-danger position-absolute top-0 start-0 m-2"
                          th:if="${product.sale}"
                          th:text="'SALE'">
                    </span>

                </div>

                <div class="card-body text-center">
                    <small class="text-muted" th:text="${product.category}"></small>
                    <h6 class="fw-bold mt-2" th:text="${product.name}"></h6>

                    <div class="mt-2">
                        <del class="text-muted me-2"
                             th:text="${product.originalPrice + 'Ïõê'}">
                        </del>

                        <span class="fw-bold text-danger"
                              th:text="${product.price + 'Ïõê'}">
                        </span>
                    </div>

                </div>

                <div class="card-footer bg-white text-center">

                    <button class="btn btn-primary w-100 rounded-pill"
                            th:onclick="'addToCart(' + ${product.id} + ')'">

                        <i class="fas fa-shopping-cart me-2"></i>
                        Ïû•Î∞îÍµ¨Îãà

                    </button>

                </div>

            </div>

        </div>

    </div>

</div>

<!-- üî• Íµ¨Î∂ÑÎùºÏù∏ -->
<div class="section-divider"></div>

<!-- ========================================================= -->
<!-- ================= PRODUCT CAROUSEL ====================== -->
<!-- ========================================================= -->

<div class="container py-5">

    <div class="text-center mb-4">
        <h2 class="fw-bold">Products</h2>
        <div class="title-line mx-auto"></div>
    </div>

    <div class="productList-carousel owl-carousel">

        <div class="border rounded p-3"
             th:each="product : ${AllProductList}">

            <div class="row">

                <div class="col-5 position-relative">

                    <img th:src="${product.imageUrl}"
                         class="img-fluid rounded"
                         style="height:120px; object-fit:cover;">

                    <a th:href="@{/product/{id}(id=${product.id})}"
                       class="mini-view-icon">
                        <i class="fa fa-eye"></i>
                    </a>

                </div>

                <div class="col-7">

                    <span class="badge bg-light text-dark"
                          th:text="${product.category}">
                    </span>

                    <h6 class="fw-bold mt-2"
                        th:text="${product.name}">
                    </h6>

                    <div class="mt-2">

                        <del class="text-muted small me-2"
                             th:text="${product.originalPrice + 'Ïõê'}">
                        </del>

                        <span class="text-danger fw-bold"
                              th:text="${product.price + 'Ïõê'}">
                        </span>

                    </div>

                </div>

            </div>

        </div>

    </div>

</div>

<!-- ========================= CSS =========================== -->

<style>

.product-card {
    transition: 0.3s ease;
}

.product-card:hover {
    transform: translateY(-8px);
    box-shadow: 0 15px 30px rgba(0,0,0,0.08);
}

.product-img {
    height: 250px;
    object-fit: cover;
}

.product-hover {
    position: absolute;
    bottom: -50px;
    left: 0;
    right: 0;
    display: flex;
    justify-content: center;
    gap: 10px;
    transition: 0.3s ease;
}

.product-img-wrap:hover .product-hover {
    bottom: 15px;
}

/* ‚úÖ ÏÑπÏÖò Íµ¨Î∂ÑÎùºÏù∏ */
.section-divider {
    height: 1px;
    background: linear-gradient(to right, transparent, #dee2e6, transparent);
    margin: 60px 0;
}

.title-line {
    width: 70px;
    height: 4px;
    background: #0d6efd;
    border-radius: 10px;
    margin: 10px auto;
}

.mini-view-icon {
    position: absolute;
    top: 8px;
    right: 8px;
    width: 35px;
    height: 35px;
    background: #0d6efd;
    color: #fff;
    border-radius: 50%;
    display:flex;
    align-items:center;
    justify-content:center;
    text-decoration:none;
}

.productList-carousel {
    position: relative;
}

.productList-carousel .owl-nav {
    position: absolute;
    top: 40%;
    width: 100%;
    display: flex;
    justify-content: space-between;
    pointer-events: none;
}

.productList-carousel .owl-nav button {
    width: 45px;
    height: 45px;
    background: #ffffff !important;
    border-radius: 50%;
    box-shadow: 0 4px 15px rgba(0,0,0,0.15);
    pointer-events: auto;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: 0.3s ease;
}

.productList-carousel .owl-nav button span {
    font-size: 26px;
    color: #0d6efd;
    font-weight: bold;
}

.productList-carousel .owl-nav button:hover {
    background: #0d6efd !important;
    transform: scale(1.1);
}

.productList-carousel .owl-nav button:hover span {
    color: #fff;
}
</style>

<!-- ========================= JS ============================ -->

<script>

function addToCart(productId) {

    fetch("/cart/add", {
        method: "POST",
        headers: {
            "Content-Type": "application/x-www-form-urlencoded"
        },
        body: "productId=" + productId + "&quantity=1"
    })
    .then(res => {
        if (!res.ok) throw new Error();
        return res.text();
    })
    .then(() => {
        if (confirm("Ïû•Î∞îÍµ¨ÎãàÏóê Ï∂îÍ∞ÄÎêòÏóàÏäµÎãàÎã§.\nÏù¥ÎèôÌïòÏãúÍ≤†ÏäµÎãàÍπå?")) {
            location.href = "/cart/list";
        }
    })
    .catch(() => alert("Ïû•Î∞îÍµ¨Îãà Ï∂îÍ∞Ä Ïã§Ìå®"));
}

function toggleWishlist(productId, btn) {

    fetch("/wishlist/toggle", {
        method: "POST",
        headers: {
            "Content-Type": "application/x-www-form-urlencoded"
        },
        body: "productId=" + productId
    })
    .then(res => {
        if (!res.ok) throw new Error();
        return res.json();
    })
    .then(data => {

        const icon = btn.querySelector("i");

        if (data === true) {
            icon.classList.remove("far","text-muted");
            icon.classList.add("fas","text-danger");
        } else {
            icon.classList.remove("fas","text-danger");
            icon.classList.add("far","text-muted");
        }

    })
    .catch(() => alert("Î°úÍ∑∏Ïù∏ ÌõÑ Ïù¥Ïö© Í∞ÄÎä•Ìï©ÎãàÎã§."));
}

</script>

<div th:replace="layout/footer :: footer"></div>

</body>
</html>