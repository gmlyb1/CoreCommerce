<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<head th:replace="layout/head :: head">
    <meta charset="utf-8">
    <title>CoreCommerce</title>
</head>

<body class="coupang-body">

<div th:replace="layout/header :: header"></div>

<!-- ========================= BANNER ========================= -->

<div class="banner-wrap">
    <div class="container">
        <div class="header-carousel owl-carousel">

            <div class="banner-item"
                 th:each="banner : ${bannerList}"
                 th:if="${banner.useYn == 'Y'}">

                <img th:if="${banner.imageUrl != null}"
                     th:src="@{${banner.imageUrl}}"
                     class="img-fluid rounded">

                <div class="banner-text">
                    <h5 th:text="${banner.subtitle}"></h5>
                    <h2 th:text="${banner.title}"></h2>
                    <p th:text="${banner.description}"></p>

                    <a th:if="${banner.linkUrl != null}"
                       th:href="${banner.linkUrl}"
                       class="btn btn-coupang">
                        ìƒí’ˆ ë³´ëŸ¬ê°€ê¸°
                    </a>
                </div>

            </div>

        </div>
    </div>
</div>

<!-- ======================= ê´‘ê³  ìƒí’ˆ ======================= -->

<div class="container section-block">

    <h2 class="section-title">ê´‘ê³  ìƒí’ˆ</h2>

    <div class="row g-4">

        <div class="col-md-6"
             th:each="offer : ${offerProductList}">

            <a th:href="@{/product/{id}(id=${offer.id})}"
               class="offer-card">

                <div>
                    <p class="text-muted small" th:text="${offer.description}"></p>
                    <h4 class="fw-bold" th:text="${offer.name}"></h4>
                    <h3 class="text-danger">
                        <span th:text="${offer.discountPercent + '%'}"></span> í• ì¸
                    </h3>
                </div>

                <img th:src="${offer.imageUrl}" class="offer-img">

            </a>

        </div>

    </div>
</div>

<!-- ===================== ë©”ì¸ ìƒí’ˆ ====================== -->

<div class="container section-block">

    <h2 class="section-title">ì „ì²´ ìƒí’ˆ</h2>

    <div class="row g-4">

        <div class="col-md-6 col-lg-3"
             th:each="product : ${MainPageList}">

            <div class="product-card"
                 th:classappend="${product.stock == 0} ? 'soldout-card'">

                <div class="product-img-wrap">

                    <img th:src="${product.imageUrl}"
                         class="product-img"
                         th:classappend="${product.stock == 0} ? 'soldout-img'">

                    <!-- <div class="soldout-label"
                         th:if="${product.stock == 0}">
                        í’ˆì ˆ
                    </div> -->

                </div>

                <div class="product-info">
                    <div class="category" th:text="${product.category}"></div>
                    <div class="name" th:text="${product.name}"></div>

                    <div class="price-wrap">
                        <del th:text="${product.originalPrice + 'ì›'}"></del>
                        <span class="price"
                              th:text="${product.price + 'ì›'}"></span>
                    </div>
                </div>

                <button class="btn btn-coupang w-100"
                        th:disabled="${product.stock == 0}"
                        th:text="${product.stock == 0} ? 'í’ˆì ˆ' : 'ì¥ë°”êµ¬ë‹ˆ'"
                        th:onclick="${product.stock > 0} ? 
                        'addToCart(' + ${product.id} + ')'">
                </button>

            </div>

        </div>

    </div>
</div>

<!-- ===================== ì „ì²´ ìƒí’ˆ ìºëŸ¬ì…€ ====================== -->

<div class="container section-block">

    <h2 class="section-title">ì¶”ì²œ ìƒí’ˆ</h2>

    <div class="productList-carousel owl-carousel">

        <div class="mini-product"
             th:each="product : ${AllProductList}">

            <img th:src="${product.imageUrl}" class="mini-img">

            <div class="mini-info">
                <div class="mini-name" th:text="${product.name}"></div>
                <div class="mini-price"
                     th:text="${product.price + 'ì›'}"></div>
            </div>

        </div>

    </div>
</div>

<div th:replace="layout/footer :: footer"></div>

<!-- ========================= STYLE =========================== -->

<style>

body.coupang-body {
    background-color: #f5f6f7;
}

/* ì„¹ì…˜ ë¸”ë¡ */
.section-block {
    background: #ffffff;
    padding: 40px;
    margin-top: 30px;
    border-radius: 8px;
}

/* ì„¹ì…˜ íƒ€ì´í‹€ */
.section-title {
    font-size: 22px;
    font-weight: 700;
    margin-bottom: 25px;
}

/* ë°°ë„ˆ */
.banner-wrap {
    background: #ffffff;
    padding: 40px 0;
}

.banner-item {
    display: flex;
    gap: 30px;
    align-items: center;
}

.banner-text h2 {
    font-weight: 700;
}

/* ê´‘ê³  ì¹´ë“œ */
.offer-card {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: #fff;
    border: 1px solid #eee;
    padding: 25px;
    border-radius: 8px;
    text-decoration: none;
    color: #000;
    transition: 0.2s;
}

.offer-card:hover {
    box-shadow: 0 4px 15px rgba(0,0,0,0.05);
}

.offer-img {
    max-height: 130px;
}

/* ìƒí’ˆ ì¹´ë“œ */
.product-card {
    border: 1px solid #eee;
    padding: 15px;
    border-radius: 6px;
    background: #fff;
    transition: 0.2s;
}

.product-card:hover {
    box-shadow: 0 4px 12px rgba(0,0,0,0.05);
}

.product-img {
    width: 100%;
    height: 220px;
    object-fit: cover;
}

.product-info {
    margin-top: 10px;
}

.category {
    font-size: 12px;
    color: #777;
}

.name {
    font-size: 14px;
    font-weight: 600;
    margin: 5px 0;
}

.price-wrap del {
    font-size: 12px;
    color: #aaa;
}

.price {
    font-size: 16px;
    font-weight: 700;
    color: #e60023;
    margin-left: 5px;
}

/* í’ˆì ˆ */
.soldout-card {
    opacity: 0.7;
}

.soldout-img {
    filter: grayscale(80%);
}

.soldout-label {
    position: absolute;
    top: 10px;
    left: 10px;
    background: #000;
    color: #fff;
    font-size: 12px;
    padding: 4px 8px;
}

/* ë²„íŠ¼ */
.btn-coupang {
    background-color: #346aff;
    border: none;
    color: #fff;
    font-weight: 600;
    padding: 10px;
    border-radius: 4px;
}

.btn-coupang:hover {
    background-color: #1f4ed8;
}

/* ë¯¸ë‹ˆ ìƒí’ˆ */
.mini-product {
    border: 1px solid #eee;
    padding: 15px;
    border-radius: 6px;
    background: #fff;
    text-align: center;
}

.mini-img {
    height: 120px;
    object-fit: cover;
    width: 100%;
}

.mini-name {
    font-size: 13px;
    margin-top: 8px;
}

.mini-price {
    font-weight: 700;
    color: #e60023;
}

/* ================= í™”ì‚´í‘œ ================= */

.productList-carousel {
    position: relative;
}

.productList-carousel .owl-nav {
    position: absolute;
    top: 50%;
    width: 100%;
    transform: translateY(-50%);
    display: flex;
    justify-content: space-between;
    pointer-events: none;
}

.productList-carousel .owl-nav button {
    width: 46px;
    height: 46px;
    border-radius: 50%;
    background: #ffffff !important;
    border: 1px solid #e5e5e5 !important;
    box-shadow: 0 6px 18px rgba(0,0,0,0.12);
    pointer-events: auto;
}

.productList-carousel .owl-nav button span {
    font-size: 22px;
    font-weight: bold;
}

/* hover */
.productList-carousel .owl-nav button:hover {
    background: #346aff !important;
    border-color: #346aff !important;
    color: #fff !important;
}
</style>
	<script th:inline="javascript">
/*<![CDATA[*/

document.addEventListener("DOMContentLoaded", function () {

    var popup = /*[[${popup}]]*/ null;

    if (popup != null) {

        window.open(
            "/popup/view/" + popup.id,
            "popupWindow",
            "width=600,height=700,left=500,top=200"
        );
    }

});

/*]]>*/
</script>
	<script>
	$(document).ready(function(){
	
	    $(".productList-carousel").owlCarousel({
	        loop: true,
	        margin: 20,
	        nav: true,          // ğŸ”¥ ì´ê±° ìˆì–´ì•¼ í™”ì‚´í‘œ ë‚˜ì˜´
	        dots: false,
	        autoplay: false,
	        responsive: {
	            0: { items: 1 },
	            768: { items: 2 },
	            1024: { items: 4 }
	        }
	    });
	
	});
	
	function addToCart(productId) {

	    fetch("/cart/add", {
	        method: "POST",
	        headers: {
	            "Content-Type": "application/x-www-form-urlencoded"
	        },
	        body: "productId=" + productId + "&quantity=1"
	    })
	    .then(res => {
	        if (!res.ok) throw new Error();
	        return res.text();
	    })
	    .then(() => {
	        alert("ì¥ë°”êµ¬ë‹ˆì— ì¶”ê°€í•˜ì˜€ìŠµë‹ˆë‹¤.");
	    })
	    .catch(() => alert("ë¡œê·¸ì¸ í•„ìš” ë˜ëŠ” ì„œë²„ ì˜¤ë¥˜"));
	}
	</script>
</body>
</html>