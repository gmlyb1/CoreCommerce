<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head th:replace="layout/head :: head"></head>

<body class="d-flex flex-column min-vh-100 bg-light">

<!-- ========================= -->
<!-- í—¤ë” -->
<!-- ========================= -->
<div th:replace="layout/header :: header"></div>

<div class="container flex-grow-1"
     style="margin-top:100px; max-width:500px; padding-bottom:150px;">

    <div class="card shadow-lg p-5" style="border-radius:15px;">

        <h3 class="text-center mb-4">ë‚´ í”„ë¡œí•„</h3>

        <!-- ========================= -->
        <!-- ğŸ”¥ í”„ë¡œí•„ ìˆ˜ì • + ì´ë¯¸ì§€ í†µí•© í¼ -->
        <!-- ========================= -->
        <form id="profileForm"
              enctype="multipart/form-data">

            <!-- í˜„ì¬ í”„ë¡œí•„ ì´ë¯¸ì§€ -->
            <div class="text-center mb-4">

                <!-- ğŸ”¥ í”„ë¡œí•„ ì´ë¯¸ì§€ ì¡´ì¬ -->
                <img th:if="${session.loginUser != null 
                             and session.loginUser.profileImage != null}"
                     th:src="@{${session.loginUser.profileImage}}"
                     width="150"
                     height="150"
                     class="rounded-circle">

                <!-- ğŸ”¥ ê¸°ë³¸ ì´ë¯¸ì§€ -->
                <img th:if="${session.loginUser == null 
                             or session.loginUser.profileImage == null}"
                     src="/images/default-profile.png"
                     width="150"
                     height="150"
                     class="rounded-circle">

            </div>

            <!-- ì´ë¦„ -->
            <div class="mb-3">
                <label class="form-label">ì´ë¦„</label>
                <input type="text"
                       name="name"
                       class="form-control"
                       th:value="${session.loginUser?.name}">
            </div>

            <!-- ì´ë©”ì¼ -->
            <div class="mb-3">
                <label class="form-label">ì´ë©”ì¼</label>
                <input type="text"
                       class="form-control"
                       th:value="${session.loginUser?.email}"
                       disabled>
            </div>

            <!-- ì „í™” -->
            <div class="mb-3">
                <label class="form-label">ì „í™”ë²ˆí˜¸</label>
                <input type="text"
                       name="phone"
                       class="form-control"
                       th:value="${session.loginUser?.phone}">
            </div>

            <!-- ì£¼ì†Œ1 -->
            <div class="mb-3">
                <label class="form-label">ì£¼ì†Œ1</label>
                <input type="text"
                       name="address1"
                       class="form-control"
                       th:value="${session.loginUser?.address1}">
            </div>

            <!-- ì£¼ì†Œ2 -->
            <div class="mb-3">
                <label class="form-label">ì£¼ì†Œ2</label>
                <input type="text"
                       name="address2"
                       class="form-control"
                       th:value="${session.loginUser?.address2}">
            </div>

            <!-- ğŸ”¥ í”„ë¡œí•„ ì´ë¯¸ì§€ ì—…ë¡œë“œ -->
            <div class="mb-3">
                <label class="form-label">í”„ë¡œí•„ ì´ë¯¸ì§€ ë³€ê²½</label>
                <input type="file"
                       name="imageFile"
                       class="form-control"
                       accept="image/*">
            </div>

            <button type="submit"
                    class="btn btn-primary w-100">
                í”„ë¡œí•„ ì €ì¥
            </button>

        </form>

        <hr class="my-4">

        <!-- ========================= -->
        <!-- ğŸ”¥ ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ -->
        <!-- ========================= -->
        <h5 class="mb-3">ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</h5>

        <form id="passwordForm">

            <div class="mb-3">
                <input type="password"
                       name="newPassword"
                       class="form-control"
                       placeholder="ìƒˆ ë¹„ë°€ë²ˆí˜¸">
            </div>

            <button type="submit"
                    class="btn btn-dark w-100">
                ë¹„ë°€ë²ˆí˜¸ ë³€ê²½
            </button>

        </form>

    </div>
</div>

<!-- ========================= -->
<!-- Axios -->
<!-- ========================= -->
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

<script>

/* ===============================
   ğŸ”¥ í”„ë¡œí•„ ìˆ˜ì • + ì´ë¯¸ì§€ ì—…ë¡œë“œ
=================================*/
document.getElementById("profileForm")
.addEventListener("submit", async function(e){

    e.preventDefault();

    const form = document.getElementById("profileForm");
    const formData = new FormData(form);

    try {
        await axios.post("/api/auth/profile/update",
            formData,
            {
                headers: {
                    "Content-Type": "multipart/form-data"
                }
            });

        alert("í”„ë¡œí•„ ì €ì¥ ì™„ë£Œ");

        // ğŸ”¥ ìƒˆë¡œê³ ì¹¨ (ì„¸ì…˜ ê°±ì‹  ë°˜ì˜)
        location.reload();

    } catch(err){
        alert("í”„ë¡œí•„ ì €ì¥ ì‹¤íŒ¨");
        console.error(err);
    }
});


/* ===============================
   ğŸ”¥ ë¹„ë°€ë²ˆí˜¸ ë³€ê²½
=================================*/
document.getElementById("passwordForm")
.addEventListener("submit", async function(e){

    e.preventDefault();

    const newPassword =
        document.querySelector("input[name='newPassword']").value;

    try {
        await axios.post("/api/auth/profile/password",
            { newPassword: newPassword });

        alert("ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ì™„ë£Œ");

        // ğŸ”¥ ì…ë ¥ê°’ ì´ˆê¸°í™”
        document.querySelector("input[name='newPassword']").value = "";

    } catch(err){
        alert("ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ì‹¤íŒ¨");
        console.error(err);
    }

});

</script>

<!-- ========================= -->
<!-- í‘¸í„° -->
<!-- ========================= -->
<div th:replace="layout/footer :: footer"></div>

</body>
</html>