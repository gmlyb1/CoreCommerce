<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="layout/head :: head"></head>

<!-- ë‹¤ìŒ(ì¹´ì¹´ì˜¤) ìš°í¸ë²ˆí˜¸ API -->
<script src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>

<style>
.register-card {
    border: none;
    border-radius: 20px;
    animation: fadeIn 0.5s ease-in-out;
}

.register-card .form-control {
    border-radius: 10px;
    transition: all 0.2s ease-in-out;
}

.register-card .form-control:focus {
    box-shadow: 0 0 0 0.15rem rgba(13, 110, 253, 0.25);
    transform: scale(1.01);
}

.register-btn {
    border-radius: 12px;
    transition: all 0.2s ease;
}

.register-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 18px rgba(0,0,0,0.15);
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(15px); }
    to { opacity: 1; transform: translateY(0); }
}
</style>

<body class="d-flex flex-column min-vh-100 bg-light">

<!-- í—¤ë” -->
<div th:replace="layout/header :: header"></div>

<!-- íšŒì›ê°€ì… í¼ -->
<div class="container flex-grow-1 d-flex justify-content-center align-items-center"
     style="margin-top: 80px; margin-bottom:80px;">

    <!-- ğŸ”¥ ë„“ì–´ì§„ ì¹´ë“œ -->
    <div class="card register-card shadow-lg p-5 bg-white"
         style="max-width: 720px; width: 100%;">

        <h3 class="text-center mb-4 fw-bold text-primary">íšŒì›ê°€ì…</h3>

        <form id="registerForm">

            <!-- ğŸ”¥ 2ì—´ ë ˆì´ì•„ì›ƒ -->
            <div class="row">

                <div class="col-md-6 mb-3">
                    <label class="form-label fw-semibold">ì´ë©”ì¼</label>
                    <input type="email"
                           id="email"
                           class="form-control form-control-lg"
                           placeholder="ì´ë©”ì¼ ì…ë ¥"
                           required>
                </div>

                <div class="col-md-6 mb-3">
                    <label class="form-label fw-semibold">ì´ë¦„</label>
                    <input type="text"
                           id="name"
                           class="form-control form-control-lg"
                           placeholder="ì´ë¦„ ì…ë ¥"
                           required>
                </div>

                <div class="col-md-6 mb-3">
                    <label class="form-label fw-semibold">ë¹„ë°€ë²ˆí˜¸</label>
                    <div class="input-group">
                        <input type="password"
                               id="password"
                               class="form-control form-control-lg"
                               placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥"
                               required>
                        <button type="button"
                                class="btn btn-outline-secondary"
                                onclick="togglePassword()">
                            ğŸ‘
                        </button>
                    </div>
                </div>

                <div class="col-md-6 mb-3">
                    <label class="form-label fw-semibold">ì „í™”ë²ˆí˜¸</label>
                    <input type="text"
                           id="phone"
                           class="form-control form-control-lg"
                           placeholder="010-1234-5678"
                           required>
                </div>

            </div>

            <!-- ì£¼ì†Œ -->
            <div class="mb-3">
                <label class="form-label fw-semibold">ì£¼ì†Œ</label>

                <div class="input-group mb-2">
                    <input type="text"
                           id="zipcode"
                           class="form-control form-control-lg"
                           placeholder="ìš°í¸ë²ˆí˜¸"
                           readonly required>

                    <button type="button"
                            class="btn btn-outline-primary"
                            onclick="execDaumPostcode()">
                        ì£¼ì†Œì°¾ê¸°
                    </button>
                </div>

                <input type="text"
                       id="address1"
                       class="form-control form-control-lg mb-2"
                       placeholder="ê¸°ë³¸ì£¼ì†Œ"
                       readonly required>

                <input type="text"
                       id="address2"
                       class="form-control form-control-lg"
                       placeholder="ìƒì„¸ì£¼ì†Œ">
            </div>

            <!-- ê°€ì… ë²„íŠ¼ -->
            <button type="submit"
                    class="btn btn-primary btn-lg w-100 register-btn fw-semibold mt-3">
                íšŒì›ê°€ì…
            </button>

        </form>

        <p class="text-center mt-4 small text-muted">
            ì´ë¯¸ ê³„ì •ì´ ìˆìœ¼ì‹ ê°€ìš”?
            <a href="/login"
               class="text-decoration-none fw-semibold text-primary">
                ë¡œê·¸ì¸
            </a>
        </p>

    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

<script>
// ë¹„ë°€ë²ˆí˜¸ ë³´ê¸° í† ê¸€
function togglePassword() {
    const input = document.getElementById("password");
    input.type = input.type === "password" ? "text" : "password";
}

// ë‹¤ìŒ ì£¼ì†Œ API
function execDaumPostcode() {
    new daum.Postcode({
        oncomplete: function(data) {
            let addr = data.roadAddress || data.jibunAddress;
            document.getElementById('zipcode').value = data.zonecode;
            document.getElementById('address1').value = addr;
            document.getElementById('address2').focus();
        }
    }).open();
}

// íšŒì›ê°€ì… ì²˜ë¦¬
document.getElementById('registerForm')
.addEventListener('submit', async (e) => {

    e.preventDefault();

    const btn = document.querySelector('.register-btn');
    btn.innerHTML = "ê°€ì… ì§„í–‰ ì¤‘...";
    btn.disabled = true;

    const email = email.value;
    const name = name.value;
    const password = password.value;
    const phone = phone.value;
    const zipcode = zipcode.value;
    const address1 = address1.value;
    const address2 = address2.value;

    try {
        await axios.post('/api/auth/register', {
            email, name, password, phone, zipcode, address1, address2
        });

        alert('íšŒì›ê°€ì…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.');
        window.location.href = '/login';

    } catch (err) {
        alert(err.response?.data?.message || 'íšŒì›ê°€ì…ì— ì‹¤íŒ¨í•˜ì˜€ìŠµë‹ˆë‹¤');
        btn.innerHTML = "íšŒì›ê°€ì…";
        btn.disabled = false;
    }
});
</script>

<!-- í‘¸í„° -->
<div th:replace="layout/footer :: footer"></div>

</body>
</html>