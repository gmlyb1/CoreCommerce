<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head th:replace="layout/head :: head">
    <title>ì£¼ë¬¸ ìƒì„¸</title>

    <style>

        body {
            background-color: #f5f6f8;
        }

        .order-wrapper {
            max-width: 1000px;
            margin: auto;
        }

        /* ì¹´ë“œ ìŠ¤íƒ€ì¼ */
        .order-card,
        .item-card {
            border-radius: 16px;
            border: none;
            background: #fff;
            box-shadow: 0 4px 12px rgba(0,0,0,0.04);
            transition: 0.2s;
        }

        .order-card:hover,
        .item-card:hover {
            transform: translateY(-3px);
        }

        .status-badge {
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            display: inline-block;
        }

        /* ìƒíƒœ ìƒ‰ìƒ */
        .status-READY { background: #ffc107; color: #000; }
        .status-PAID { background: #0d6efd; color: #fff; }
        .status-SHIPPED { background: #198754; color: #fff; }
        .status-CANCELLED { background: #dc3545; color: #fff; }

        .product-img {
            width: 90px;
            height: 90px;
            object-fit: cover;
            border-radius: 12px;
        }

    </style>

</head>

<body>

<div th:replace="layout/header :: header"></div>

<div class="container py-5 order-wrapper">

    <h2 class="fw-bold mb-4">ğŸ“¦ ì£¼ë¬¸ ìƒì„¸</h2>

    <!-- ================= ì£¼ë¬¸ ì •ë³´ ì¹´ë“œ ================= -->
    <div class="card order-card p-4 mb-4">

        <div class="d-flex justify-content-between align-items-center mb-3">
            <h5 class="fw-bold mb-0">
                ì£¼ë¬¸ë²ˆí˜¸ #<span th:text="${order.id}"></span>
            </h5>

            <!-- ìƒíƒœ -->
            <span th:class="'status-badge status-' + ${order.status}"
                  th:text="${order.status}">
            </span>
        </div>

        <hr>

        <div class="row">

            <div class="col-md-6">
                <p><strong>ğŸ’° ì´ ê²°ì œê¸ˆì•¡</strong></p>
                <h4 class="text-danger fw-bold"
                    th:text="${T(java.lang.String).format('%,dì›', order.totalPrice)}">
                </h4>
            </div>

            <div class="col-md-6 text-end">
                <p><strong>ğŸ“… ì£¼ë¬¸ì¼</strong></p>
                <span class="text-muted"
                      th:text="${#temporals.format(order.createdAt,'yyyy-MM-dd HH:mm')}">
                </span>
            </div>

        </div>

        <!-- âœ… ì£¼ë¬¸ ì·¨ì†Œ ë²„íŠ¼ -->
        <div class="text-end mt-3"
             th:if="${order.status != 'CANCELLED'}">

            <button class="btn btn-danger px-4"
                    th:onclick="'cancelOrder(' + ${order.id} + ')'">
                ì£¼ë¬¸ ì·¨ì†Œ
            </button>

        </div>

    </div>


    <!-- ================= ì£¼ë¬¸ ìƒí’ˆ ë¦¬ìŠ¤íŠ¸ ================= -->
    <h5 class="fw-bold mb-3">ğŸ›’ ì£¼ë¬¸ ìƒí’ˆ</h5>

    <div class="row g-3">

        <div class="col-12"
             th:each="item : ${items}">

            <div class="card item-card p-3">

                <div class="d-flex align-items-center gap-4">

                    <!-- ìƒí’ˆ ì´ë¯¸ì§€ -->
                    <img th:src="${item.productImage}"
                         class="product-img">

                    <!-- ìƒí’ˆ ì •ë³´ -->
                    <div class="flex-grow-1">

                        <h6 class="fw-bold"
                            th:text="${item.productName}">
                        </h6>

                        <p class="mb-1 text-muted small">
                            ìˆ˜ëŸ‰ :
                            <span th:text="${item.quantity}"></span>
                        </p>

                        <p class="mb-0 fw-bold text-primary"
                           th:text="${T(java.lang.String).format('%,dì›', item.price * item.quantity)}">
                        </p>

                    </div>

                </div>

            </div>

        </div>

    </div>

</div>


<!-- ================= ìŠ¤í¬ë¦½íŠ¸ ================= -->
<script>

function cancelOrder(orderId){

    if(!confirm("ì •ë§ ì£¼ë¬¸ì„ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;

    fetch("/order/cancel/" + orderId, {
        method : "POST"
    })
    .then(res => res.text())
    .then(result => {

        if(result === "OK"){
            alert("ì·¨ì†Œ ì™„ë£Œ");
            location.reload();
        }
        else if(result === "LOGIN_REQUIRED"){
            alert("ë¡œê·¸ì¸ í•„ìš”");
            location.href = "/login";
        }
        else{
            alert("ì·¨ì†Œ ì‹¤íŒ¨");
        }

    });

}

</script>

<div th:replace="layout/footer :: footer"></div>

</body>
</html>