<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="layout/head :: head"></head>
<body class="d-flex flex-column min-vh-100">

<!-- 헤더 -->
<div th:replace="layout/header :: header"></div>

<!-- 로그인 폼 -->
<div class="container flex-grow-1 d-flex justify-content-center align-items-center" style="margin-top: 80px; margin-bottom: 80px;">
    <div class="card p-4 shadow-sm" style="max-width: 400px; width: 100%;">
        <h3 class="text-center mb-4">로그인</h3>

        <form method="post" id="loginForm">
            <div class="mb-3">
                <label>아이디</label>
                <input type="text" name="username" class="form-control" placeholder="이메일 또는 아이디">
            </div>

            <div class="mb-3">
                <label>비밀번호</label>
                <input type="password" name="password" class="form-control" placeholder="비밀번호">
            </div>

            <div class="text-danger mb-3" th:if="${error}" th:text="${error}"></div>

            <button class="btn btn-primary w-100">로그인</button>
        </form>

        <p class="text-center mt-3">
            계정이 없으신가요? 
            <a href="/register" class="text-decoration-none">회원가입</a>
        </p>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script>
document.getElementById("loginForm").addEventListener("submit", async function(e) {
    e.preventDefault();

    const email = document.querySelector("input[name='username']").value;
    const password = document.querySelector("input[name='password']").value;

    try {
        const res = await axios.post("/api/auth/login", {
            email: email,
            password: password
        });

        // JWT 저장
        localStorage.setItem("token", res.data.token);

        alert("로그인 성공");
        window.location.href = "/";
    } catch (err) {
        alert("로그인 실패");
    }
});
</script>
<!-- 푸터 -->
<div th:replace="layout/footer :: footer"></div>

</body>
</html>
