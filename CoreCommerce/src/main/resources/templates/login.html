<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="layout/head :: head"></head>

<style>
/* ì¹´ë“œ ìŠ¤íƒ€ì¼ */
.login-card {
    border: none;
    border-radius: 18px;
    animation: fadeIn 0.5s ease-in-out;
}

/* ì…ë ¥ì°½ */
.login-card .form-control {
    border-radius: 10px;
    transition: all 0.2s ease-in-out;
}

.login-card .form-control:focus {
    box-shadow: 0 0 0 0.15rem rgba(13, 110, 253, 0.25);
}

/* ë²„íŠ¼ */
.login-btn {
    border-radius: 10px;
    transition: all 0.2s ease;
}

.login-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(0,0,0,0.15);
}

/* ì†Œì…œ ë²„íŠ¼ */
.social-btn {
    border-radius: 10px;
    transition: all 0.2s ease;
}

.social-btn:hover {
    transform: translateY(-2px);
}

/* ì• ë‹ˆë©”ì´ì…˜ */
@keyframes fadeIn {
    from { opacity: 0; transform: translateY(15px); }
    to { opacity: 1; transform: translateY(0); }
}
</style>

<body class="d-flex flex-column min-vh-100 bg-light">

<!-- í—¤ë” -->
<div th:replace="layout/header :: header"></div>

<!-- ë¡œê·¸ì¸ ì˜ì—­ -->
<div class="container flex-grow-1 d-flex justify-content-center align-items-center"
     style="margin-top: 100px; margin-bottom: 100px;">

    <!-- ğŸ”¥ ë„“ì–´ì§„ ì¹´ë“œ -->
    <div class="card login-card shadow-lg p-4 bg-white"
         style="max-width: 560px; width: 100%;">

        <div class="text-center mb-4">
            <h2 class="fw-bold">ë¡œê·¸ì¸</h2>
            <p class="text-muted mb-0">ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸í•˜ì„¸ìš”</p>
        </div>

        <form method="post" id="loginForm">

            <!-- ì•„ì´ë”” -->
            <div class="mb-3">
                <label class="form-label fw-semibold">ì•„ì´ë””</label>
                <div class="input-group">
                    <span class="input-group-text">
                        <i class="bi bi-person-fill"></i>
                    </span>
                    <input type="text"
                           name="username"
                           class="form-control"
                           placeholder="ì´ë©”ì¼ ë˜ëŠ” ì•„ì´ë””"
                           required>
                </div>
            </div>

            <!-- ë¹„ë°€ë²ˆí˜¸ -->
            <div class="mb-3">
                <label class="form-label fw-semibold">ë¹„ë°€ë²ˆí˜¸</label>
                <div class="input-group">
                    <span class="input-group-text">
                        <i class="bi bi-lock-fill"></i>
                    </span>
                    <input type="password"
                           name="password"
                           class="form-control"
                           id="password"
                           placeholder="ë¹„ë°€ë²ˆí˜¸"
                           required>
                    <button type="button"
                            class="btn btn-outline-secondary"
                            onclick="togglePassword()">
                        ğŸ‘
                    </button>
                </div>
            </div>

            <!-- ì˜¤ë¥˜ ë©”ì‹œì§€ -->
            <div class="text-danger mb-3 text-center"
                 th:if="${error}"
                 th:text="${error}">
            </div>

            <!-- ë¡œê·¸ì¸ ë²„íŠ¼ -->
            <button class="btn btn-primary w-100 fw-bold py-2 login-btn">
                ë¡œê·¸ì¸
            </button>
        </form>

        <!-- í•˜ë‹¨ ë§í¬ -->
        <div class="mt-4 text-center">
            <div>
                <span class="text-muted">ê³„ì •ì´ ì—†ìœ¼ì‹ ê°€ìš”?</span>
                <a href="/register"
                   class="text-decoration-none fw-semibold ms-1">
                    íšŒì›ê°€ì…
                </a>
            </div>
            <div class="mt-2">
                <a href="/member/find-id"
                   class="text-decoration-none small me-3">
                    ì•„ì´ë”” ì°¾ê¸°
                </a>
                <a href="/member/find-password"
                   class="text-decoration-none small">
                    ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°
                </a>
            </div>
        </div>

        <hr class="my-4">

        <!-- ì†Œì…œ ë¡œê·¸ì¸ -->
        <!-- <div class="text-center text-muted">
            <small>ë˜ëŠ” ì†Œì…œ ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸</small>
        </div>

        <div class="d-flex justify-content-center mt-3 gap-2">
            <button class="btn btn-light border social-btn w-100">
                <i class="bi bi-google text-danger"></i> Google
            </button>
            <button class="btn btn-dark social-btn w-100">
                <i class="bi bi-github"></i> GitHub
            </button>
        </div> -->

    </div>
</div>

<!-- Axios -->
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

<script>
function togglePassword() {
    const input = document.getElementById("password");
    input.type = input.type === "password" ? "text" : "password";
}

document.getElementById("loginForm").addEventListener("submit", async function(e) {
    e.preventDefault();

    const email = document.querySelector("input[name='username']").value;
    const password = document.querySelector("input[name='password']").value;

    const btn = document.querySelector(".login-btn");
    btn.innerHTML = "ë¡œê·¸ì¸ ì¤‘...";
    btn.disabled = true;

    try {
        const res = await axios.post("/api/auth/login", {
            email: email,
            password: password
        });

        const result = res.data;

        if (typeof result === "string" && result.startsWith("LOCKED:")) {
            const days = result.split(":")[1];
            alert(`í•´ë‹¹ ê³„ì •ì€ ${days}ì¼ ë™ì•ˆ ì ê¸´ ê³„ì •ì…ë‹ˆë‹¤`);
            btn.innerHTML = "ë¡œê·¸ì¸";
            btn.disabled = false;
            return;
        }

        if (typeof result === "string" && result !== "redirect:/") {
            alert(result);
            btn.innerHTML = "ë¡œê·¸ì¸";
            btn.disabled = false;
            return;
        }

        if (result === "redirect:/") {
            alert("ë¡œê·¸ì¸ì— ì„±ê³µí•˜ì˜€ìŠµë‹ˆë‹¤.");
            location.href = "/";
        }

    } catch (err) {
        alert("ë¡œê·¸ì¸ ìš”ì²­ì— ì‹¤íŒ¨í•˜ì˜€ìŠµë‹ˆë‹¤.");
        btn.innerHTML = "ë¡œê·¸ì¸";
        btn.disabled = false;
    }
});
</script>

<!-- í‘¸í„° -->
<div th:replace="layout/footer :: footer"></div>

</body>
</html>