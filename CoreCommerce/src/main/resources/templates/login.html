<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="layout/head :: head"></head>
<body class="d-flex flex-column min-vh-100 bg-light">

<!-- í—¤ë” -->
<div th:replace="layout/header :: header"></div>

<!-- ë¡œê·¸ì¸ í¼ -->
<div class="container flex-grow-1 d-flex justify-content-center align-items-center" style="margin-top: 100px; margin-bottom: 100px;">
    <div class="card shadow-lg p-5" style="max-width: 420px; width: 100%; border-radius: 15px; background: #ffffff;">
        <div class="text-center mb-4">
            <h2 class="fw-bold">ë¡œê·¸ì¸</h2>
            <p class="text-muted">ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸í•˜ì„¸ìš”</p>
        </div>

        <form method="post" id="loginForm">
            <div class="mb-3">
                <label class="form-label fw-semibold">ì•„ì´ë””</label>
                <div class="input-group">
                    <span class="input-group-text"><i class="bi bi-person-fill"></i></span>
                    <input type="text" name="username" class="form-control" placeholder="ì´ë©”ì¼ ë˜ëŠ” ì•„ì´ë””" required>
                </div>
            </div>

            <div class="mb-3">
                <label class="form-label fw-semibold">ë¹„ë°€ë²ˆí˜¸</label>
                <div class="input-group">
                    <span class="input-group-text"><i class="bi bi-lock-fill"></i></span>
                    <input type="password" name="password" class="form-control" placeholder="ë¹„ë°€ë²ˆí˜¸" required>
                </div>
            </div>

            <!-- ì˜¤ë¥˜ ë©”ì‹œì§€ -->
            <div class="text-danger mb-3 text-center" th:if="${error}" th:text="${error}"></div>

            <button class="btn btn-primary w-100 fw-bold py-2" style="border-radius: 10px;">ë¡œê·¸ì¸</button>
        </form>

        <div class="mt-4 text-center">
		    <div>
		        <span class="text-muted">ê³„ì •ì´ ì—†ìœ¼ì‹ ê°€ìš”?</span>
		        <a href="/register"
		           class="text-decoration-none fw-semibold ms-1">
		            íšŒì›ê°€ì…
		        </a>
		    </div>
		    <div class="mt-2">
		
		        <a href="/member/find-id"
		           class="text-decoration-none small me-3">
		            ì•„ì´ë”” ì°¾ê¸°
		        </a>
		
		        <a href="/member/find-password"
		           class="text-decoration-none small">
		            ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°
		        </a>
		    </div>
		</div>

        <hr class="my-4">

        <div class="text-center text-muted">
            <small>ë˜ëŠ” ì†Œì…œ ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸</small>
        </div>

        <div class="d-flex justify-content-center mt-3 gap-2">
            <button class="btn btn-outline-primary w-100"><i class="bi bi-google"></i> Google</button>
            <button class="btn btn-outline-dark w-100"><i class="bi bi-github"></i> GitHub</button>
        </div>
    </div>
</div>

<!-- Axios ë¡œê·¸ì¸ ìŠ¤í¬ë¦½íŠ¸ -->
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script>
document.getElementById("loginForm").addEventListener("submit", async function(e) {
    e.preventDefault();

    const email = document.querySelector("input[name='username']").value;
    const password = document.querySelector("input[name='password']").value;

    /* try {
        const res = await axios.post("/api/auth/login", {
            email: email,
            password: password
        });

        // JWT ì €ì¥
        localStorage.setItem("token", res.data.token);

        alert("ë¡œê·¸ì¸ì— ì„±ê³µí•˜ì˜€ìŠµë‹ˆë‹¤.");
        window.location.href = "/";
    } catch (err) {
        alert("ì•„ì´ë”” í˜¹ì€ ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
    } */
    
    try {

        const res = await axios.post("/api/auth/login", {
            email: email,
            password: password
        });

        const result = res.data;

        // ğŸ”¥ ê³„ì • ì ê¹€ ì²˜ë¦¬
        if (typeof result === "string" && result.startsWith("LOCKED:")) {

            const days = result.split(":")[1];

            alert(`í•´ë‹¹ ê³„ì •ì€ ${days}ì¼ ë™ì•ˆ ì ê¸´ ê³„ì •ì…ë‹ˆë‹¤`);

            return;
        }

        // ğŸ”¥ ì¼ë°˜ ì‹¤íŒ¨ ë©”ì‹œì§€
        if (typeof result === "string" && result !== "redirect:/") {

            alert(result);
            return;
        }

        // ğŸ”¥ ë¡œê·¸ì¸ ì„±ê³µ
        if (result === "redirect:/") {

            alert("ë¡œê·¸ì¸ì— ì„±ê³µ í•˜ì˜€ìŠµë‹ˆë‹¤.");
            location.href = "/";
        }

    } catch (err) {

        alert("ë¡œê·¸ì¸ ìš”ì²­ì— ì‹¤íŒ¨í•˜ì˜€ìŠµë‹ˆë‹¤. ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”");
    }
});
</script>

<!-- í‘¸í„° -->sms 
<div th:replace="layout/footer :: footer"></div>

</body>
</html>
